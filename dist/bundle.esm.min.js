import{Vector3 as t,Plane as e,Line3 as i,Sphere as s,Box3 as o,Triangle as n,Layers as a,Controls as r,AnimationObjectGroup as h,AnimationMixer as l,Group as c,CapsuleGeometry as d,LineSegments as u,LineBasicMaterial as p,BoxGeometry as m}from"three";function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,b(s.key),s)}}function f(t,e,i){return e&&v(t.prototype,e),i&&v(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function b(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var g=function(){function e(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t(0,0,0),s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t(0,1,0),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;y(this,e),this.start=i,this.end=s,this.radius=o}return f(e,[{key:"clone",value:function(){return new e(this.start.clone(),this.end.clone(),this.radius)}},{key:"set",value:function(t,e,i){this.start.copy(t),this.end.copy(e),this.radius=i}},{key:"copy",value:function(t){this.start.copy(t.start),this.end.copy(t.end),this.radius=t.radius}},{key:"getCenter",value:function(t){return t.copy(this.end).add(this.start).multiplyScalar(.5)}},{key:"translate",value:function(t){this.start.add(t),this.end.add(t)}},{key:"checkAABBAxis",value:function(t,e,i,s,o,n,a,r,h){return(o-t<h||o-i<h)&&(t-n<h||i-n<h)&&(a-e<h||a-s<h)&&(e-r<h||s-r<h)}},{key:"intersectsBox",value:function(t){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,t.min.x,t.max.x,t.min.y,t.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,t.min.x,t.max.x,t.min.z,t.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,t.min.y,t.max.y,t.min.z,t.max.z,this.radius)}}])}(),_=new t,x=new t,w=new t,k=new t,T=new e,S=new i,M=new i,O=new s,j=new g,A=new t,C=new t,P=new t;function z(t,e){var i,s,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=A.copy(t.end).sub(t.start),r=C.copy(e.end).sub(e.start),h=P.copy(e.start).sub(t.start),l=a.dot(r),c=a.dot(a),d=r.dot(r),u=r.dot(h),p=a.dot(h),m=c*d-l*l;if(Math.abs(m)<1e-10){var y=-u/d,v=(l-u)/d;Math.abs(y-.5)<Math.abs(v-.5)?(i=0,s=y):(i=1,s=v)}else s=((i=(u*l+p*d)/m)*l-u)/d;s=Math.max(0,Math.min(1,s)),i=Math.max(0,Math.min(1,i)),o&&o.copy(a).multiplyScalar(i).add(t.start),n&&n.copy(r).multiplyScalar(s).add(e.start)}var V=function(){function e(t){y(this,e),this.box=t,this.bounds=new o,this.subTrees=[],this.triangles=[],this.layers=new a}return f(e,[{key:"addTriangle",value:function(t){return this.bounds.min.x=Math.min(this.bounds.min.x,t.a.x,t.b.x,t.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,t.a.y,t.b.y,t.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,t.a.z,t.b.z,t.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,t.a.x,t.b.x,t.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,t.a.y,t.b.y,t.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,t.a.z,t.b.z,t.c.z),this.triangles.push(t),this}},{key:"calcBox",value:function(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}},{key:"split",value:function(t){if(this.box){for(var i,s=[],n=x.copy(this.box.max).sub(this.box.min).multiplyScalar(.5),a=0;a<2;a++)for(var r=0;r<2;r++)for(var h=0;h<2;h++){var l=new o,c=_.set(a,r,h);l.min.copy(this.box.min).add(c.multiply(n)),l.max.copy(l.min).add(n),s.push(new e(l))}for(;i=this.triangles.pop();)for(var d=0;d<s.length;d++)s[d].box.intersectsTriangle(i)&&s[d].triangles.push(i);for(var u=0;u<s.length;u++){var p=s[u].triangles.length;p>8&&t<16&&s[u].split(t+1),0!==p&&this.subTrees.push(s[u])}return this}}},{key:"build",value:function(){return this.calcBox(),this.split(0),this}},{key:"getRayTriangles",value:function(t,e){for(var i=0;i<this.subTrees.length;i++){var s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var o=0;o<s.triangles.length;o++)-1===e.indexOf(s.triangles[o])&&e.push(s.triangles[o]);else s.getRayTriangles(t,e)}return e}},{key:"triangleCapsuleIntersect",value:function(t,e){e.getPlane(T);var i=T.distanceToPoint(t.start)-t.radius,s=T.distanceToPoint(t.end)-t.radius;if(i>0&&s>0||i<-t.radius&&s<-t.radius)return!1;var o=Math.abs(i/(Math.abs(i)+Math.abs(s))),n=_.copy(t.start).lerp(t.end,o);if(e.containsPoint(n))return{normal:T.normal.clone(),point:n.clone(),depth:Math.abs(Math.min(i,s))};for(var a=t.radius*t.radius,r=S.set(t.start,t.end),h=[[e.a,e.b],[e.b,e.c],[e.c,e.a]],l=0;l<h.length;l++){if(z(r,M.set(h[l][0],h[l][1]),w,k),w.distanceToSquared(k)<a)return{normal:w.clone().sub(k).normalize(),point:k.clone(),depth:t.radius-w.distanceTo(k)}}return!1}},{key:"triangleSphereIntersect",value:function(t,e){if(e.getPlane(T),!t.intersectsPlane(T))return!1;var i=Math.abs(T.distanceToSphere(t)),s=t.radius*t.radius-i*i,o=T.projectPoint(t.center,_);if(e.containsPoint(t.center))return{normal:T.normal.clone(),point:o.clone(),depth:Math.abs(T.distanceToSphere(t))};for(var n=[[e.a,e.b],[e.b,e.c],[e.c,e.a]],a=0;a<n.length;a++){S.set(n[a][0],n[a][1]),S.closestPointToPoint(o,!0,x);var r=x.distanceToSquared(t.center);if(r<s)return{normal:t.center.clone().sub(x).normalize(),point:x.clone(),depth:t.radius-Math.sqrt(r)}}return!1}},{key:"getSphereTriangles",value:function(t,e){for(var i=0;i<this.subTrees.length;i++){var s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var o=0;o<s.triangles.length;o++)-1===e.indexOf(s.triangles[o])&&e.push(s.triangles[o]);else s.getSphereTriangles(t,e)}}},{key:"getCapsuleTriangles",value:function(t,e){for(var i=0;i<this.subTrees.length;i++){var s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(var o=0;o<s.triangles.length;o++)-1===e.indexOf(s.triangles[o])&&e.push(s.triangles[o]);else s.getCapsuleTriangles(t,e)}}},{key:"sphereIntersect",value:function(t){O.copy(t);var e,i=[],s=!1;this.getSphereTriangles(t,i);for(var o=0;o<i.length;o++)(e=this.triangleSphereIntersect(O,i[o]))&&(s=!0,O.center.add(e.normal.multiplyScalar(e.depth)));if(s){var n=O.center.clone().sub(t.center),a=n.length();return{normal:n.normalize(),depth:a}}return!1}},{key:"capsuleIntersect",value:function(e){j.copy(e);var i,s=[],o=!1;this.getCapsuleTriangles(j,s);for(var n=0;n<s.length;n++)(i=this.triangleCapsuleIntersect(j,s[n]))&&(o=!0,j.translate(i.normal.multiplyScalar(i.depth)));if(o){var a=j.getCenter(new t).sub(e.getCenter(_)),r=a.length();return{normal:a.normalize(),depth:r}}return!1}},{key:"rayIntersect",value:function(t){if(0!==t.direction.length()){var e,i,s=[],o=1e100;this.getRayTriangles(t,s);for(var n=0;n<s.length;n++){var a=t.intersectTriangle(s[n].a,s[n].b,s[n].c,!0,_);if(a){var r=a.sub(t.origin).length();o>r&&(i=a.clone().add(t.origin),o=r,e=s[n])}}return o<1e100&&{distance:o,triangle:e,position:i}}}},{key:"fromGraphNode",value:function(e){var i=this;return e.updateWorldMatrix(!0,!0),e.traverse((function(e){if(!0===e.isMesh&&i.layers.test(e.layers)){var s,o=!1;null!==e.geometry.index?(o=!0,s=e.geometry.toNonIndexed()):s=e.geometry;for(var a=s.getAttribute("position"),r=0;r<a.count;r+=3){var h=(new t).fromBufferAttribute(a,r),l=(new t).fromBufferAttribute(a,r+1),c=(new t).fromBufferAttribute(a,r+2);h.applyMatrix4(e.matrixWorld),l.applyMatrix4(e.matrixWorld),c.applyMatrix4(e.matrixWorld),i.addTriangle(new n(h,l,c))}o&&s.dispose()}})),this.build(),this}},{key:"clear",value:function(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}])}();class E extends g{constructor(t,e,i){super(t,e,i)}get height(){return this.start.distanceTo(this.end)+2*this.radius}}const L={type:"collide"},G={type:"fall"},D={type:"grounded"};class H extends r{constructor(e,i,s,n){var a,r,h;super(e,i),this.velocity=new t,this._isGrounded=!1,this._deltaPosition=new t,this._worldOctree=new V,this._worldOctree.fromGraphNode(s);const l=new t;(new o).setFromObject(this.object).getSize(l);const c=(null==n?void 0:n.colliderRadius)||l.y/4,d=(null==n?void 0:n.colliderHeight)||l.y;this._capsuleCollider=new E(new t(0,c,0),new t(0,d-c,0),c),this._capsuleCollider.translate(e.position),this.gravity=null!==(a=null==n?void 0:n.gravity)&&void 0!==a?a:30,this.maxFallSpeed=null!==(r=null==n?void 0:n.maxFallSpeed)&&void 0!==r?r:20,this.movementResistance=null!==(h=null==n?void 0:n.movementResistance)&&void 0!==h?h:4,this.boundary=null==n?void 0:n.boundary}get isGrounded(){return this._isGrounded}get collider(){return this._capsuleCollider}checkCollisions(){this._isGrounded=!1;const t=this._worldOctree.capsuleIntersect(this._capsuleCollider);t&&(this.dispatchEvent(L),t.normal.y>0?(this._isGrounded=!0,this.dispatchEvent(D)):(this.velocity.addScaledVector(t.normal,-t.normal.dot(this.velocity)),this.dispatchEvent(G)),t.depth>=1e-10&&this._capsuleCollider.translate(t.normal.multiplyScalar(t.depth)))}update(t){if(!this.enabled)return;super.update(t);let e=Math.exp(-this.movementResistance*t)-1;this._isGrounded||(this.velocity.y-=this.gravity*t,this.velocity.y=Math.max(this.velocity.y,-this.maxFallSpeed),e*=.1),this.velocity.addScaledVector(this.velocity,e),this._deltaPosition.copy(this.velocity).multiplyScalar(t),this._capsuleCollider.translate(this._deltaPosition),this.checkCollisions(),this.teleportPlayerIfOutOfBounds(),this.object.position.copy(this._capsuleCollider.start),this.object.position.y-=this._capsuleCollider.radius}teleportPlayerIfOutOfBounds(){if(!this.boundary)return;const{resetPoint:t,x:e,y:i,z:s}=this.boundary,{x:o,y:n,z:a}=this.object.position;(o<e.min||o>e.max||n<i.min||n>i.max||a<s.min||a>s.max)&&(this._capsuleCollider.start.set(t.x,t.y+this._capsuleCollider.radius,t.z),this._capsuleCollider.end.set(t.x,t.y+this._capsuleCollider.height-this._capsuleCollider.radius,t.z),this.object.position.copy(t),this.velocity.set(0,0,0))}connect(){super.connect()}disconnect(){super.disconnect()}dispose(){super.dispose()}}class B{constructor(t,e){this._animationClips={},this._animationActions={},this._objectGroup=new h(t),this._mixer=new l(this._objectGroup),e&&Object.entries(e).forEach((([t,e])=>{this.setAnimationClip(t,e)}))}get clips(){return Object.freeze(Object.assign({},this._animationClips))}addObject(t){this._objectGroup.add(t)}removeObject(t){this._objectGroup.remove(t)}setAnimationClip(t,e){const i=this._mixer.clipAction(e);this._animationClips[t]=e,this._animationActions[t]=i}removeAnimationClip(t){const e=this._animationClips[t];if(!e)return;const i=this._animationActions[t];i&&(i.stop(),this._mixer.uncacheAction(e,this._objectGroup)),this._mixer.uncacheClip(e),delete this._animationClips[t],delete this._animationActions[t]}fadeToAction(t,e){const i=this._animationActions[t];i&&!i.isRunning()&&(Object.values(this._animationActions).forEach((t=>{t.fadeOut(e)})),i.reset(),i.fadeIn(e),i.play())}update(t){this._mixer.update(t)}dispose(){this._mixer.stopAllAction(),this._mixer.uncacheRoot(this._objectGroup)}}const I={};class F extends H{constructor(e,i,s,o,n,a,r){var h,l,c,d,u,p,m;super(e,i,s,r),this.camera=null,this.cameraPosOffset=null,this.cameraLookAtOffset=null,this._tempVector=new t,this._direction=new t;const{idle:y,forward:v,backward:f,jump:b,fall:g}=a||{};this._characters=new B(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},y&&{idle:y}),v&&{forward:v}),f&&{backward:f}),b&&{jump:b}),g&&{fall:g})),this.keyOptions=o,n&&(this.camera=n.camera,this.cameraPosOffset=n.posOffset.clone(),this.cameraLookAtOffset=n.lookAtOffset.clone()),this.jumpForce=null!==(h=null==r?void 0:r.jumpForce)&&void 0!==h?h:15,this.groundMoveSpeed=null!==(l=null==r?void 0:r.groundMoveSpeed)&&void 0!==l?l:25,this.floatMoveSpeed=null!==(c=null==r?void 0:r.floatMoveSpeed)&&void 0!==c?c:8,this.rotateSpeed=null!==(d=null==r?void 0:r.rotateSpeed)&&void 0!==d?d:1,this.transitionTime=null!==(u=null==a?void 0:a.transitionTime)&&void 0!==u?u:.3,this.fallSpeedThreshold=null!==(p=null==a?void 0:a.fallSpeedThreshold)&&void 0!==p?p:15,this.moveSpeedThreshold=null!==(m=null==a?void 0:a.moveSpeedThreshold)&&void 0!==m?m:1,this.onKeyDownHandler=this.onKeyDown.bind(this),this.onKeyUpHandler=this.onKeyUp.bind(this),this.connect()}getForwardVector(){return this.object.getWorldDirection(this._direction),this._direction.y=0,this._direction.normalize(),this._direction}updateControls(t){var e,i,s,o,n;const a=t*(this.isGrounded?this.groundMoveSpeed:this.floatMoveSpeed);(null===(e=this.keyOptions.forward)||void 0===e?void 0:e.some((t=>I[t])))&&this.velocity.add(this.getForwardVector().multiplyScalar(a)),(null===(i=this.keyOptions.backward)||void 0===i?void 0:i.some((t=>I[t])))&&this.velocity.add(this.getForwardVector().multiplyScalar(-a)),(null===(s=this.keyOptions.leftTurn)||void 0===s?void 0:s.some((t=>I[t])))&&this.object.rotateY(t*this.rotateSpeed),(null===(o=this.keyOptions.rightTurn)||void 0===o?void 0:o.some((t=>I[t])))&&this.object.rotateY(t*-this.rotateSpeed),this.isGrounded&&(null===(n=this.keyOptions.jump)||void 0===n?void 0:n.some((t=>I[t])))&&(this.velocity.y=this.jumpForce)}updateCamera(){if(!this.camera||!this.cameraPosOffset||!this.cameraLookAtOffset)return;this.object.updateMatrixWorld();const t=this.cameraPosOffset.clone().applyMatrix4(this.object.matrixWorld);this.camera.position.copy(t),this.camera.lookAt(this.object.getWorldPosition(this._tempVector).add(this.cameraLookAtOffset))}updateAnimation(t){var e;this._characters.update(t),this.object.getWorldDirection(this._direction);const i=this._direction.dot(this.velocity);if(this.isGrounded&&i>this.moveSpeedThreshold)this._characters.fadeToAction("forward",this.transitionTime);else if(this.isGrounded&&i<-this.moveSpeedThreshold)this._characters.fadeToAction("backward",this.transitionTime);else if(this.isGrounded)this._characters.fadeToAction("idle",this.transitionTime);else if(this.velocity.y>0){!!(null===(e=this.keyOptions.jump)||void 0===e?void 0:e.some((t=>I[t])))&&this._characters.fadeToAction("jump",this.transitionTime)}else this.velocity.y<-this.fallSpeedThreshold&&this._characters.fadeToAction("fall",this.transitionTime)}update(t){this.updateControls(t),super.update(t),this.updateCamera(),this.updateAnimation(t)}connect(){super.connect(),document.addEventListener("keydown",this.onKeyDownHandler),document.addEventListener("keyup",this.onKeyUpHandler)}disconnect(){super.disconnect(),document.removeEventListener("keydown",this.onKeyDownHandler),document.removeEventListener("keyup",this.onKeyUpHandler)}dispose(){this.disconnect(),super.dispose(),this._characters.dispose()}onKeyDown(t){I[t.key]=!0}onKeyUp(t){I[t.key]=!1}}class K extends H{constructor(e,i,s,o,n,a={},r={}){super(e,i,s,r),this._cameraRadius=0,this._cameraPhi=0,this._cameraTheta=0,this.keyStates={},this._isMouseDown=!1,this._tempVector1=new t,this._tempVector2=new t,this._tempVector3=new t,this.onKeyDown=t=>{this.keyStates[t.key]=!0},this.onKeyUp=t=>{this.keyStates[t.key]=!1},this.onMouseDown=()=>{this._isMouseDown=!0},this.onMouseUp=()=>{this._isMouseDown=!1},this.onMouseMove=t=>{this._isMouseDown&&(this._cameraTheta+=t.movementX*this.rotateSpeed/100,this._cameraPhi-=t.movementY*this.rotateSpeed/100,this._cameraPhi=Math.max(.01,Math.min(Math.PI-.01,this._cameraPhi)))};const{idle:h,forward:l,jump:c,fall:d}=a||{};this._characters=new B(e,Object.assign(Object.assign(Object.assign(Object.assign({},h&&{idle:h}),l&&{forward:l}),c&&{jump:c}),d&&{fall:d})),this.keyOptions=o,this.camera=n.camera,this._cameraPositionOffset=n.posOffset,this._cameraLookAtOffset=n.lookAtOffset,this.updateCameraInfo();const{jumpForce:u=15,groundMoveSpeed:p=25,floatMoveSpeed:m=8,rotateSpeed:y=1}=r;this.jumpForce=u,this.groundMoveSpeed=p,this.floatMoveSpeed=m,this.rotateSpeed=y;const{transitionTime:v=.3,fallSpeedThreshold:f=15,moveSpeedThreshold:b=1}=a;this.transitionTime=v,this.fallSpeedThreshold=f,this.moveSpeedThreshold=b,this.connect()}get cameraPosOffset(){return this._cameraPositionOffset}set cameraPosOffset(t){this._cameraPositionOffset=t,this.updateCameraInfo()}get cameraLookAtOffset(){return this._cameraLookAtOffset}set cameraLookAtOffset(t){this._cameraLookAtOffset=t,this.updateCameraInfo()}updateCameraInfo(){const t=this._tempVector1.copy(this._cameraPositionOffset).sub(this._cameraLookAtOffset);this._cameraRadius=t.length(),this._cameraPhi=Math.acos(t.y/this._cameraRadius),this._cameraTheta=Math.atan2(t.z,t.x)}getForwardVector(){return this.camera.getWorldDirection(this._tempVector1),this._tempVector1.y=0,this._tempVector1.normalize(),this._tempVector1}getSideVector(){return this.camera.getWorldDirection(this._tempVector2),this._tempVector2.y=0,this._tempVector2.normalize(),this._tempVector2.cross(this.object.up),this._tempVector2}updateControls(t){var e,i,s,o,n;this.isGrounded&&(null===(e=this.keyOptions.jump)||void 0===e?void 0:e.some((t=>this.keyStates[t])))&&(this.velocity.y=this.jumpForce);const a=t*(this.isGrounded?this.groundMoveSpeed:this.floatMoveSpeed),r=this._tempVector3.set(0,0,0);(null===(i=this.keyOptions.leftward)||void 0===i?void 0:i.some((t=>this.keyStates[t])))&&r.add(this.getSideVector().multiplyScalar(-1)),(null===(s=this.keyOptions.rightward)||void 0===s?void 0:s.some((t=>this.keyStates[t])))&&r.add(this.getSideVector()),(null===(o=this.keyOptions.backward)||void 0===o?void 0:o.some((t=>this.keyStates[t])))&&r.add(this.getForwardVector().multiplyScalar(-1)),(null===(n=this.keyOptions.forward)||void 0===n?void 0:n.some((t=>this.keyStates[t])))&&r.add(this.getForwardVector()),r.lengthSq()>1e-10&&(r.normalize(),this.velocity.add(r.multiplyScalar(a)),this.object.lookAt(this.object.position.clone().add(r)))}updateCamera(){this.object.updateMatrixWorld();const t=this._cameraRadius*Math.sin(this._cameraPhi)*Math.cos(this._cameraTheta),e=this._cameraRadius*Math.cos(this._cameraPhi),i=this._cameraRadius*Math.sin(this._cameraPhi)*Math.sin(this._cameraTheta),s=this._tempVector1.copy(this._cameraLookAtOffset).applyMatrix4(this.object.matrixWorld),o=this._tempVector2.set(t,e,i).add(s);this.camera.position.copy(o);const n=this._tempVector3.copy(this.object.position).add(this._cameraLookAtOffset);this.camera.lookAt(n)}updateAnimation(t){this._characters.update(t),this.object.getWorldDirection(this._tempVector1);const e=this._tempVector1.copy(this.velocity);e.y=0;const i=e.length();this.isGrounded&&i>this.moveSpeedThreshold?this._characters.fadeToAction("forward",this.transitionTime):this.isGrounded?this._characters.fadeToAction("idle",this.transitionTime):this.velocity.y>0?this._characters.fadeToAction("jump",this.transitionTime):this.velocity.y<-this.fallSpeedThreshold&&this._characters.fadeToAction("fall",this.transitionTime)}update(t){this.updateControls(t),super.update(t),this.updateCamera(),this.updateAnimation(t)}connect(){var t,e;super.connect(),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),null===(t=this.domElement)||void 0===t||t.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mouseup",this.onMouseUp),null===(e=this.domElement)||void 0===e||e.addEventListener("mousemove",this.onMouseMove)}disconnect(){var t,e;super.disconnect(),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),null===(t=this.domElement)||void 0===t||t.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mouseup",this.onMouseUp),null===(e=this.domElement)||void 0===e||e.removeEventListener("mousemove",this.onMouseMove)}dispose(){this.disconnect(),super.dispose(),this._characters.dispose()}}class R extends c{constructor(e,i=16777215){super(),this.type="PhysicsControlsHelper",this._capsulePosition=new t,this.controls=e;const s=new d(e.collider.radius,e.collider.height-2*e.collider.radius);if(this.capsuleHelper=new u(s,new p({color:i,toneMapped:!1})),this.add(this.capsuleHelper),e.boundary){const t=e.boundary.x.max-e.boundary.x.min,s=e.boundary.y.max-e.boundary.y.min,o=e.boundary.z.max-e.boundary.z.min,n=new m(t,s,o);this.boundaryHelper=new u(n,new p({color:i,toneMapped:!1})),this.boundaryHelper.position.set(e.boundary.x.min+t/2,e.boundary.y.min+s/2,e.boundary.z.min+o/2),this.add(this.boundaryHelper)}this.matrixAutoUpdate=!1,this.update()}update(){this.controls.object.updateMatrixWorld(!0),this._capsulePosition.copy(this.controls.object.position),this._capsulePosition.y+=this.controls.collider.height/2,this.capsuleHelper.position.copy(this._capsulePosition),this.capsuleHelper.rotation.copy(this.controls.object.rotation),this.updateMatrix()}dispose(){this.capsuleHelper.geometry.dispose(),this.capsuleHelper.material.dispose(),this.boundaryHelper&&(this.boundaryHelper.geometry.dispose(),this.capsuleHelper.material.dispose()),this.clear()}}export{F as KeyboardObjectRotationControls,K as MouseDragCameraRotationControls,R as PhysicsControlsHelper};
